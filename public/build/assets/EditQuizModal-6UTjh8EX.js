import{r as c,b as S,j as t,a as q}from"./app-wmMc2fTp.js";import{c as p,Q as _}from"./QuizForm-D8oJoWZ4.js";import{I as g}from"./Icon-DwnJikYR.js";import"./FormInput-CRJD2SCI.js";import"./FormSelect-BT2xAVr2.js";function P({isOpen:x,onClose:v,quizId:a,modules:N}){const[i,b]=c.useState(!1),[r,y]=c.useState(!1),[w,u]=c.useState({}),[m,f]=c.useState({title:"",moduleId:"",quizContext:"post-test",questions:[p(1)]});c.useEffect(()=>{x&&a&&C(a)},[x,a]);const C=async s=>{y(!0);try{const o=(await S.get(route("admin.quiz.get",s))).data,l=o.questions?.map((d,h)=>({id:h+1,text:d.question,type:"multiple_choice",isExpanded:h===0,points:d.points||1,options:d.options?.map((j,E)=>({id:(h+1)*100+E,text:j.label,isCorrect:j.is_correct}))||[]}))||[p(1)];f({title:o.title,moduleId:o.module_id?.toString()||"",quizContext:o.is_pretest?"pretest":"post-test",questions:l.length>0?l:[p(1)]}),u({})}catch(e){console.error("Error fetching quiz:",e),n()}finally{y(!1)}},n=()=>{f({title:"",moduleId:"",quizContext:"post-test",questions:[p(1)]}),u({}),v()},z=()=>{if(!a)return;b(!0),u({});const s={title:m.title,is_pretest:m.quizContext==="pretest",questions:m.questions.map((e,o)=>({question:e.text,points:e.points||1,sort_order:o+1,options:e.options.map((l,d)=>({label:l.text,is_correct:l.isCorrect,sort_order:d+1}))}))};q.put(route("admin.quiz.update",a),s,{preserveScroll:!0,onSuccess:()=>{n()},onError:e=>{u(e)},onFinish:()=>{b(!1)}})};return x?t.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center overflow-y-auto",children:[t.jsx("div",{className:"fixed inset-0 bg-black/50 transition-opacity",onClick:()=>!i&&!r&&n()}),t.jsxs("div",{className:"relative z-10 my-8 w-full max-w-5xl rounded-xl bg-slate-100 p-6 shadow-xl",children:[t.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[t.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Edit Kuis"}),t.jsx("button",{onClick:n,disabled:i||r,className:"rounded-md p-2 text-slate-400 hover:bg-slate-200 hover:text-slate-600 disabled:opacity-50",children:t.jsx(g,{name:"close",size:24})})]}),t.jsx("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto rounded-lg bg-white p-6",children:r?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex flex-col items-center gap-3",children:[t.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"}),t.jsx("p",{className:"text-sm text-slate-500",children:"Memuat data kuis..."})]})}):t.jsx(_,{data:m,errors:w,modules:N.map(s=>({id:s.id,title:s.title})),onDataChange:f,isCompact:!0,showModuleSelector:!1})}),t.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3 border-t border-slate-200 pt-6",children:[t.jsx("button",{type:"button",onClick:n,disabled:i||r,className:"rounded-md px-4 py-2.5 text-sm font-medium text-slate-600 transition-colors hover:bg-slate-200 disabled:opacity-50",children:"Batal"}),t.jsxs("button",{type:"button",onClick:z,disabled:i||r,className:"flex items-center gap-2 rounded-md bg-primary px-4 py-2.5 text-sm font-bold text-white shadow-md shadow-primary/20 transition-all hover:bg-[#00622e] disabled:opacity-50",children:[t.jsx(g,{name:"save",size:18}),i?"Menyimpan...":"Simpan Perubahan"]})]})]})]}):null}export{P as default};
