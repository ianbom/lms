import{r as b,j as i,a as M}from"./app-BMQkHA4d.js";import{c as x,M as w}from"./ModuleForm-OGYFwVUO.js";import{I as g}from"./Icon-CFmQEsGQ.js";const E=o=>{const n=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/)([^&\n?#]+)/,/youtube\.com\/shorts\/([^&\n?#]+)/];for(const s of n){const r=o.match(s);if(r&&r[1])return r[1]}return null},N=o=>{const n=Math.floor(o/3600),s=Math.floor(o%3600/60),r=Math.floor(o%60);return n>0?`${n}:${s.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`:`${s}:${r.toString().padStart(2,"0")}`},P=o=>{if(!o)return"0m";const n=Math.floor(o/3600),s=Math.floor(o%3600/60),r=o%60;return n>0?`${n}j ${s}m`:`${s}m ${r}d`};function U({isOpen:o,onClose:n,moduleId:s,modules:r}){const[c,y]=b.useState(!1),[v,p]=b.useState({}),[m,f]=b.useState({title:"",description:"",videos:[x(1)]});b.useEffect(()=>{if(o&&s){const e=r.find(t=>t.id===s);if(!e)return;const a=e.videos.map((t,l)=>{const d=E(t.youtube_url),_=d?`https://img.youtube.com/vi/${d}/maxresdefault.jpg`:void 0;return{id:l+1,title:t.title,youtubeUrl:t.youtube_url,duration:N(t.duration_sec),durationSec:t.duration_sec,description:t.description||"",thumbnailUrl:_,isPreview:t.is_preview,files:(t.resources||[]).map((u,S)=>({id:S+1,name:u.title,size:u.file_size?`${(u.file_size/1024/1024).toFixed(1)} MB`:"0 MB",type:u.file_type,progress:100,isUploading:!1,uploadedAt:"Uploaded",existingUrl:u.file_url}))}});f({title:e.title,description:e.description||"",videos:a.length>0?a:[x(1)]}),p({})}},[o,s,r]);const h=()=>{f({title:"",description:"",videos:[x(1)]}),p({}),n()},$=e=>{f(e)},j=()=>{if(!s)return;y(!0),p({});const e=new FormData;e.append("title",m.title),e.append("description",m.description),e.append("_method","PUT"),m.videos.forEach((a,t)=>{e.append(`videos[${t}][title]`,a.title),e.append(`videos[${t}][description]`,a.description),e.append(`videos[${t}][youtube_url]`,a.youtubeUrl),e.append(`videos[${t}][is_preview]`,a.isPreview?"1":"0"),e.append(`videos[${t}][duration_sec]`,a.durationSec.toString()),a.files.forEach((l,d)=>{e.append(`videos[${t}][resources][${d}][title]`,l.name),e.append(`videos[${t}][resources][${d}][file_type]`,l.type),l.file&&e.append(`videos[${t}][resources][${d}][file]`,l.file),l.existingUrl&&e.append(`videos[${t}][resources][${d}][existing_url]`,l.existingUrl)})}),M.post(route("admin.module.update",s),e,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{h()},onError:a=>{p(a)},onFinish:()=>{y(!1)}})};return o?i.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center overflow-y-auto",children:[i.jsx("div",{className:"fixed inset-0 bg-black/50 transition-opacity",onClick:()=>!c&&h()}),i.jsxs("div",{className:"relative z-10 my-8 w-full max-w-5xl rounded-xl bg-slate-100 p-6 shadow-xl",children:[i.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[i.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Edit Modul"}),i.jsx("button",{onClick:h,disabled:c,className:"rounded-md p-2 text-slate-400 hover:bg-slate-200 hover:text-slate-600 disabled:opacity-50",children:i.jsx(g,{name:"close",size:24})})]}),i.jsx("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto rounded-lg bg-white p-6",children:i.jsx(w,{data:m,errors:v,onDataChange:$,isCompact:!0})}),i.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3 border-t border-slate-200 pt-6",children:[i.jsx("button",{type:"button",onClick:h,disabled:c,className:"rounded-md px-4 py-2.5 text-sm font-medium text-slate-600 transition-colors hover:bg-slate-200 disabled:opacity-50",children:"Batal"}),i.jsxs("button",{type:"button",onClick:j,disabled:c,className:"flex items-center gap-2 rounded-md bg-primary px-4 py-2.5 text-sm font-bold text-white shadow-md shadow-primary/20 transition-all hover:bg-[#00622e] disabled:opacity-50",children:[i.jsx(g,{name:"save",size:18}),c?"Menyimpan...":"Simpan Perubahan"]})]})]})]}):null}const k=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"}));export{U as E,k as a,P as f};
