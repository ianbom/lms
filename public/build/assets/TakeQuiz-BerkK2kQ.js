import{j as e,L as B,r as m,b as F,a as O,H as E}from"./app-n3Ak61V3.js";import{I as d}from"./Icon-6ctnq2p_.js";import{U as J}from"./UserDashboardLayout-DNFsz0UB.js";import"./Toast-jpASXoAK.js";function R({quiz:s,previousAttempts:t,onStart:r,onBack:a}){const c=t.length>0?Math.max(...t.map(n=>n.score)):null,o=s.total_points||s.questions.reduce((n,l)=>n+l.points,0);return e.jsxs("div",{className:"shadow-card mx-auto w-full max-w-2xl rounded-2xl border border-slate-100 bg-white p-8",children:[e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsx("div",{className:"flex h-20 w-20 items-center justify-center rounded-2xl bg-primary/10",children:e.jsx(d,{name:"quiz",size:40,className:"text-primary"})})}),e.jsx("h2",{className:"mb-2 text-center text-2xl font-bold text-slate-900",children:s.title}),e.jsxs("p",{className:"mb-8 text-center text-slate-500",children:[s.is_pretest?"Pre-Test":"Quiz"," • ",s.module?.title]}),e.jsxs("div",{className:"mb-8 grid grid-cols-3 gap-4",children:[e.jsx(L,{value:s.questions.length,label:"Pertanyaan"}),e.jsx(L,{value:o,label:"Total Poin"}),e.jsx(L,{value:"70%",label:"Nilai Lulus"})]}),t.length>0&&e.jsx(V,{attempts:t,bestScore:c}),e.jsx(W,{}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:a,className:"flex flex-1 items-center justify-center gap-2 rounded-xl border border-slate-200 px-6 py-3 font-semibold text-slate-600 transition-colors hover:bg-slate-50",children:[e.jsx(d,{name:"arrow_back",size:20}),"Kembali"]}),e.jsxs("button",{onClick:r,className:"flex flex-1 items-center justify-center gap-2 rounded-xl bg-primary px-6 py-3 font-semibold text-white transition-colors hover:bg-primary/90",children:["Mulai Quiz",e.jsx(d,{name:"play_arrow",size:20})]})]})]})}function L({value:s,label:t}){return e.jsxs("div",{className:"rounded-xl bg-slate-50 p-4 text-center",children:[e.jsx("div",{className:"mb-1 text-2xl font-bold text-slate-900",children:s}),e.jsx("div",{className:"text-sm text-slate-500",children:t})]})}function V({attempts:s,bestScore:t}){return e.jsxs("div",{className:"mb-8 rounded-xl border border-slate-100 bg-slate-50 p-4",children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold text-slate-700",children:"Riwayat Pengerjaan"}),e.jsx("div",{className:"space-y-2",children:s.slice(0,3).map((r,a)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-slate-500",children:["Percobaan ",s.length-a]}),e.jsxs("span",{className:`font-semibold ${r.is_passed?"text-green-600":"text-red-500"}`,children:[r.score,"%"," ",r.is_passed?"(Lulus)":"(Tidak Lulus)"]})]},r.id))}),t!==null&&e.jsx("div",{className:"mt-3 border-t border-slate-200 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-slate-700",children:"Nilai Terbaik"}),e.jsxs("span",{className:"font-bold text-primary",children:[t,"%"]})]})})]})}function W(){return e.jsxs("div",{className:"mb-8 rounded-xl bg-amber-50 p-4",children:[e.jsxs("h3",{className:"mb-2 flex items-center gap-2 text-sm font-semibold text-amber-800",children:[e.jsx(d,{name:"info",size:18}),"Petunjuk Pengerjaan"]}),e.jsxs("ul",{className:"space-y-1 text-sm text-amber-700",children:[e.jsx("li",{children:"• Jawab semua pertanyaan dengan memilih satu opsi"}),e.jsx("li",{children:"• Anda dapat berpindah antar pertanyaan dengan bebas"}),e.jsx("li",{children:"• Pastikan semua pertanyaan terjawab sebelum mengumpulkan"}),e.jsx("li",{children:"• Nilai minimal untuk lulus adalah 70%"})]})]})}function G({question:s,questionIndex:t,totalQuestions:r,selectedOptionId:a,onSelectOption:c,onNext:o,onPrev:n,onSubmit:l,isLastQuestion:x,isFirstQuestion:p,isSubmitting:f,isReviewing:j,quizResult:g,backToVideoUrl:N}){const h=u=>{if(!j||!g)return null;const v=g.answers.find(y=>y.questionId===s.id);return v?u===v.correctOptionId?"correct":u===v.selectedOptionId&&!v.isCorrect?"incorrect":null:null};return e.jsxs("div",{className:"shadow-card flex min-h-[600px] flex-col overflow-hidden rounded-xl border border-slate-200 bg-white",children:[e.jsxs("div",{className:"bg-pri px-6 pb-4 pt-8",children:[e.jsxs("div",{className:"mb-4 flex items-start justify-between",children:[e.jsxs("span",{className:"inline-block rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-slate-600",children:["Soal ",t+1," dari ",r]}),e.jsx("button",{className:"text-slate-400 transition-colors hover:text-yellow-500",title:"Laporkan soal",children:e.jsx(d,{name:"flag",size:20})})]}),e.jsx("h2",{className:"text-xl font-bold leading-tight text-slate-900 md:text-2xl",dangerouslySetInnerHTML:{__html:Y(s.question)}})]}),e.jsx("div",{className:"flex-grow px-6 py-2",children:e.jsx("div",{className:"flex flex-col gap-4",children:s.options.map(u=>e.jsx(X,{option:u,isSelected:a===u.id,optionState:h(u.id),isReviewing:j,onSelect:()=>c(u.id)},u.id))})}),e.jsx(Z,{onPrev:n,onNext:o,onSubmit:l,isFirstQuestion:p,isLastQuestion:x,isSubmitting:f,isReviewing:j,backToVideoUrl:N})]})}function Y(s){return s.replace(/`([^`]+)`/g,'<code class="rounded bg-slate-100 px-1.5 py-0.5 font-mono text-[0.9em] text-pink-600">$1</code>')}function X({option:s,isSelected:t,optionState:r,isReviewing:a,onSelect:c}){const o=()=>{const x="group relative flex cursor-pointer items-start gap-4 rounded-xl border-2 p-4 transition-all duration-200";return a?r==="correct"?`${x} border-green-500 bg-green-50`:r==="incorrect"?`${x} border-red-500 bg-red-50`:t?`${x} border-slate-300 bg-slate-50`:`${x} border-slate-200 bg-white`:t?`${x} border-primary bg-primary/5`:`${x} border-slate-200 bg-white hover:border-slate-300`},n=()=>a&&r==="correct"?"border-green-500 bg-green-500":a&&r==="incorrect"?"border-red-500 bg-red-500":t?"border-primary bg-white":"border-slate-300 bg-transparent",l=()=>a&&r==="correct"?"font-medium text-green-700":a&&r==="incorrect"?"font-medium text-red-700":t?"font-medium text-slate-900":"text-slate-700";return e.jsxs("label",{className:o(),onClick:a?void 0:c,children:[e.jsxs("div",{className:"relative mt-0.5 flex flex-shrink-0 items-center justify-center",children:[e.jsx("input",{type:"radio",name:"answer",checked:t,onChange:()=>{},className:"peer sr-only",disabled:a}),e.jsxs("div",{className:`flex h-5 w-5 items-center justify-center rounded-full border-2 ${n()}`,children:[t&&!a&&e.jsx("div",{className:"h-2.5 w-2.5 rounded-full bg-primary"}),a&&r==="correct"&&e.jsx(d,{name:"check",size:14,className:"text-white"}),a&&r==="incorrect"&&e.jsx(d,{name:"close",size:14,className:"text-white"})]})]}),e.jsx("div",{className:"flex-grow",children:e.jsx("span",{className:`block text-sm md:text-base ${l()} transition-colors group-hover:text-primary`,children:s.label})})]})}function Z({onPrev:s,onNext:t,onSubmit:r,isFirstQuestion:a,isLastQuestion:c,isSubmitting:o,isReviewing:n,backToVideoUrl:l}){return e.jsx("div",{className:"mt-auto border-t border-slate-100 bg-slate-50/50 px-6 py-6",children:e.jsxs("div",{className:"flex flex-col-reverse items-center justify-between gap-4 sm:flex-row",children:[n&&l?e.jsxs(B,{href:l,className:"flex w-full items-center justify-center gap-2 rounded-md border border-slate-300 bg-white px-6 py-2.5 text-sm font-bold text-slate-700 transition-colors hover:bg-slate-50 sm:w-auto",children:[e.jsx(d,{name:"arrow_back",size:18}),"Kembali ke Video"]}):e.jsx("div",{className:"hidden sm:block"}),e.jsxs("div",{className:"flex w-full items-center gap-3 sm:w-auto",children:[e.jsx("button",{onClick:s,disabled:a,className:"flex flex-1 items-center justify-center gap-2 rounded-md border border-slate-300 px-6 py-2.5 text-sm font-bold text-slate-700 transition-colors hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50 sm:flex-none",children:"Sebelumnya"}),c&&!n?e.jsx("button",{onClick:r,disabled:o,className:"flex flex-1 transform items-center justify-center gap-2 rounded-md bg-primary px-6 py-2.5 text-sm font-bold text-white shadow-md transition-all hover:bg-green-700 hover:shadow-lg active:scale-95 disabled:opacity-50 sm:flex-none",children:o?e.jsxs(e.Fragment,{children:[e.jsx(d,{name:"progress_activity",size:18,className:"animate-spin"}),"Mengirim..."]}):e.jsxs(e.Fragment,{children:["Kumpulkan",e.jsx(d,{name:"send",size:18})]})}):e.jsxs("button",{onClick:t,disabled:c&&n,className:"flex flex-1 transform items-center justify-center gap-2 rounded-md bg-primary px-6 py-2.5 text-sm font-bold text-white shadow-md transition-all hover:bg-green-700 hover:shadow-lg active:scale-95 disabled:opacity-50 sm:flex-none",children:["Selanjutnya",e.jsx(d,{name:"arrow_forward",size:18})]})]})]})})}function D({result:s,quiz:t,timeSpent:r,onReview:a,onRetry:c,onBack:o}){const n=s.totalQuestions-s.correctAnswers,l=s.correctAnswers/s.totalQuestions*100;return e.jsxs("div",{className:"shadow-card mx-auto w-full max-w-2xl rounded-2xl border border-slate-100 bg-white p-8",children:[e.jsx(se,{isPassed:s.isPassed}),e.jsx(te,{score:s.score,isPassed:s.isPassed}),e.jsxs("div",{className:"mb-8 grid grid-cols-3 gap-4",children:[e.jsx(M,{icon:"check_circle",iconColor:"text-green-500",value:s.correctAnswers,label:"Benar"}),e.jsx(M,{icon:"cancel",iconColor:"text-red-500",value:n,label:"Salah"}),e.jsx(M,{icon:"schedule",iconColor:"text-blue-500",value:ee(r),label:"Waktu"})]}),e.jsx(re,{correct:s.correctAnswers,total:s.totalQuestions,percent:l,isPassed:s.isPassed}),e.jsx(ae,{isPassed:s.isPassed,onBack:o,onReview:a,onRetry:c})]})}function ee(s){const t=Math.floor(s/60),r=s%60;return`${t}:${r.toString().padStart(2,"0")}`}function se({isPassed:s}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsx("div",{className:`flex h-24 w-24 items-center justify-center rounded-full ${s?"bg-green-100":"bg-red-100"}`,children:e.jsx(d,{name:s?"emoji_events":"sentiment_dissatisfied",size:48,className:s?"text-green-600":"text-red-500"})})}),e.jsx("h2",{className:`mb-2 text-center text-2xl font-bold ${s?"text-green-600":"text-red-500"}`,children:s?"Selamat! Anda Lulus!":"Belum Berhasil"}),e.jsx("p",{className:"mb-8 text-center text-slate-500",children:s?"Anda telah menyelesaikan quiz dengan baik":"Jangan menyerah! Coba lagi untuk mendapatkan hasil yang lebih baik"})]})}function te({score:s,isPassed:t}){return e.jsx("div",{className:"mb-8 flex justify-center",children:e.jsx("div",{className:`relative flex h-40 w-40 items-center justify-center rounded-full border-8 ${t?"border-green-500":"border-red-400"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-4xl font-bold ${t?"text-green-600":"text-red-500"}`,children:[s,"%"]}),e.jsx("div",{className:"text-sm text-slate-500",children:"Nilai Anda"})]})})})}function M({icon:s,iconColor:t,value:r,label:a}){return e.jsxs("div",{className:"rounded-xl bg-slate-50 p-4 text-center",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-center gap-1",children:[e.jsx(d,{name:s,size:20,className:t}),e.jsx("span",{className:"text-xl font-bold text-slate-900",children:r})]}),e.jsx("div",{className:"text-sm text-slate-500",children:a})]})}function re({correct:s,total:t,percent:r,isPassed:a}){return e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"mb-2 flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Progress"}),e.jsxs("span",{className:"font-medium text-slate-700",children:[s," / ",t," pertanyaan benar"]})]}),e.jsx("div",{className:"h-3 w-full overflow-hidden rounded-full bg-slate-100",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${a?"bg-green-500":"bg-red-400"}`,style:{width:`${r}%`}})})]})}function ae({isPassed:s,onBack:t,onReview:r,onRetry:a}){return e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:t,className:"flex flex-1 items-center justify-center gap-2 rounded-xl border border-slate-200 px-6 py-3 font-semibold text-slate-600 transition-colors hover:bg-slate-50",children:[e.jsx(d,{name:"arrow_back",size:20}),"Kembali"]}),e.jsxs("button",{onClick:r,className:"flex flex-1 items-center justify-center gap-2 rounded-xl border border-primary px-6 py-3 font-semibold text-primary transition-colors hover:bg-primary/5",children:[e.jsx(d,{name:"visibility",size:20}),"Lihat Jawaban"]}),!s&&e.jsxs("button",{onClick:a,className:"flex flex-1 items-center justify-center gap-2 rounded-xl bg-primary px-6 py-3 font-semibold text-white transition-colors hover:bg-primary/90",children:[e.jsx(d,{name:"refresh",size:20}),"Coba Lagi"]})]})}function ne({quiz:s,currentQuestionIndex:t,userAnswers:r,quizState:a,timeSpent:c,onQuestionSelect:o,onSubmit:n,isSubmitting:l,progressStats:x}){const p=r.filter(h=>h.optionId!==null).length,f=s.questions.length,j=f-p,g=h=>{const u=Math.floor(h/60),v=h%60;return`${u.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`},N=h=>h===t?"current":r[h]?.optionId!==null?"answered":"unanswered";return e.jsxs("aside",{className:"z-20 flex h-full w-full shrink-0 flex-col gap-4 overflow-y-auto bg-slate-50/50 p-4 pt-14 sm:gap-6 lg:w-[340px] lg:pt-4",children:[(a==="in-progress"||a==="reviewing")&&e.jsx(le,{timeSpent:c,formatTime:g,totalQuestions:f,answeredCount:p,remainingCount:j}),a!=="intro"&&e.jsx(ie,{quiz:s,currentQuestionIndex:t,getQuestionStatus:N,onQuestionSelect:o}),a==="in-progress"&&n&&e.jsx(de,{onSubmit:n,isSubmitting:l,answeredCount:p,totalQuestions:f}),a==="intro"&&e.jsx(oe,{quiz:s,totalQuestions:f}),e.jsx(ce,{progressStats:x})]})}function le({timeSpent:s,formatTime:t,totalQuestions:r,answeredCount:a,remainingCount:c}){return e.jsxs("div",{className:"shadow-card rounded-xl border border-slate-200 bg-white p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-slate-500",children:"Waktu"}),e.jsx(d,{name:"timer",size:20,className:"text-slate-400"})]}),e.jsx("div",{className:"mb-6 rounded-md border border-slate-100 bg-slate-50 py-3 text-center font-mono text-4xl font-bold tracking-tight text-slate-900",children:t(s)}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 border-t border-slate-100 pt-4 text-center text-xs",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-medium text-slate-400",children:"Total"}),e.jsx("span",{className:"text-base font-bold text-slate-700",children:r})]}),e.jsxs("div",{className:"flex flex-col gap-1 border-x border-slate-100",children:[e.jsx("span",{className:"font-medium text-green-600",children:"Terjawab"}),e.jsx("span",{className:"text-base font-bold text-green-700",children:a})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-medium text-slate-400",children:"Sisa"}),e.jsx("span",{className:"text-base font-bold text-slate-700",children:c})]})]})]})}function ie({quiz:s,currentQuestionIndex:t,getQuestionStatus:r,onQuestionSelect:a}){return e.jsxs("div",{className:"shadow-card rounded-xl border border-slate-200 bg-white p-6",children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-slate-500",children:"Navigasi Soal"})}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:s.questions.map((c,o)=>{const n=r(o);let l="aspect-square flex items-center justify-center rounded-md font-bold text-sm transition-colors";return n==="current"?l+=" bg-white text-primary border-2 border-primary shadow-sm":n==="answered"?l+=" bg-green-100 text-green-700 border border-transparent hover:border-green-300":l+=" bg-slate-50 text-slate-500 font-medium border border-slate-200 hover:bg-slate-100",e.jsx("button",{onClick:()=>a(o),className:l,children:o+1},o)})}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-x-4 gap-y-2 text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-3 w-3 rounded-full border border-green-200 bg-green-100"}),e.jsx("span",{children:"Terjawab"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-3 w-3 rounded-full border-2 border-primary bg-white"}),e.jsx("span",{children:"Saat ini"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-3 w-3 rounded-full border border-slate-200 bg-slate-50"}),e.jsx("span",{children:"Belum"})]})]})]})}function de({onSubmit:s,isSubmitting:t,answeredCount:r,totalQuestions:a}){const c=r===a;return e.jsxs("div",{className:"shadow-card rounded-xl border border-slate-200 bg-white p-4",children:[e.jsx("p",{className:"mb-3 text-center text-xs text-slate-400",children:c?"Semua jawaban sudah terisi.":`${r}/${a} soal terjawab. Pastikan semua terisi.`}),e.jsx("button",{onClick:s,disabled:t,className:"flex w-full items-center justify-center gap-2 rounded-md bg-primary px-4 py-3 text-sm font-bold text-white shadow-md transition-all hover:bg-green-700 hover:shadow-lg disabled:opacity-50",children:t?e.jsxs(e.Fragment,{children:[e.jsx(d,{name:"progress_activity",size:20,className:"animate-spin"}),"Mengirim..."]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{name:"check_circle",size:20}),"Submit Quiz"]})})]})}function oe({quiz:s,totalQuestions:t}){return e.jsxs("div",{className:"shadow-card rounded-xl border border-slate-200 bg-white p-6",children:[e.jsx("h4",{className:"mb-4 text-xs font-bold uppercase tracking-wider text-slate-400",children:"Informasi Quiz"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 rounded-xl bg-slate-50 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-md bg-blue-100",children:e.jsx(d,{name:"help",size:20,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-slate-900",children:t}),e.jsx("div",{className:"text-sm text-slate-500",children:"Pertanyaan"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-xl bg-slate-50 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-md bg-amber-100",children:e.jsx(d,{name:"star",size:20,className:"text-amber-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-slate-900",children:s.total_points||s.questions.reduce((r,a)=>r+a.points,0)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Poin"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-xl bg-slate-50 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-md bg-green-100",children:e.jsx(d,{name:"verified",size:20,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-slate-900",children:"70%"}),e.jsx("div",{className:"text-sm text-slate-500",children:"Nilai Minimum Lulus"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-xl bg-slate-50 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-md bg-purple-100",children:e.jsx(d,{name:"refresh",size:20,className:"text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-slate-900",children:"Unlimited"}),e.jsx("div",{className:"text-sm text-slate-500",children:"Percobaan"})]})]})]})]})}function ce({progressStats:s}){return e.jsxs("div",{className:"shadow-card rounded-xl border border-slate-200 bg-white p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-slate-500",children:"Progress Kelas"}),e.jsxs("span",{className:"font-bold text-primary",children:[s.progress_percent,"%"]})]}),e.jsx("div",{className:"h-2 w-full rounded-full bg-slate-200",children:e.jsx("div",{className:"h-2 rounded-full bg-primary transition-all duration-300",style:{width:`${s.progress_percent}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:[s.completed_videos," / ",s.total_videos," ","video selesai"]})]})}function xe({quiz:s,attempt:t,classId:r,videoId:a}){const[c,o]=m.useState(t?.submitted_at?"submitted":"intro"),[n,l]=m.useState(0),[x,p]=m.useState(()=>s.questions.map(i=>({questionId:i.id,optionId:null}))),[f,j]=m.useState(0),[g,N]=m.useState(!1),[h,u]=m.useState(null),v=s.questions[n],y=s.questions.length,Q=x.filter(i=>i.optionId!==null).length,k=n===y-1,S=n===0;m.useEffect(()=>{let i;return c==="in-progress"&&(i=setInterval(()=>{j(b=>b+1)},1e3)),()=>clearInterval(i)},[c]);const $=m.useCallback(i=>{const b=Math.floor(i/60),T=i%60;return`${b.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`},[]),C=m.useCallback(async()=>{try{await F.post(`/user/study/${r}/quiz/${s.id}/start`),o("in-progress")}catch(i){console.error("Failed to start quiz:",i),o("in-progress")}},[r,s.id]),z=m.useCallback((i,b)=>{p(T=>T.map(A=>A.questionId===i?{...A,optionId:b}:A))},[]),_=m.useCallback(i=>{l(i)},[]),I=m.useCallback(()=>{n<y-1&&l(i=>i+1)},[n,y]),P=m.useCallback(()=>{n>0&&l(i=>i-1)},[n]),w=m.useCallback(async()=>{const i=x.filter(b=>b.optionId===null);if(!(i.length>0&&!window.confirm(`Masih ada ${i.length} pertanyaan yang belum dijawab. Yakin ingin mengumpulkan?`))){N(!0);try{const b=await F.post(`/user/study/${r}/quiz/${s.id}/submit`,{answers:x});u(b.data.result),o("submitted")}catch(b){console.error("Failed to submit quiz:",b),alert("Gagal mengumpulkan quiz. Silakan coba lagi.")}finally{N(!1)}}},[r,s.id,x]),K=m.useCallback(()=>{o("reviewing"),l(0)},[]),H=m.useCallback(()=>{p(s.questions.map(i=>({questionId:i.id,optionId:null}))),j(0),l(0),u(null),o("intro")},[s.questions]),U=m.useCallback(()=>{a?O.visit(`/user/study/${r}/video/${a}`):O.visit(`/user/classes/${r}`)},[r,a]),q=m.useCallback(i=>x.find(b=>b.questionId===i)?.optionId??null,[x]);return{quizState:c,currentQuestionIndex:n,userAnswers:x,timeSpent:f,isSubmitting:g,quizResult:h,currentQuestion:v,totalQuestions:y,answeredCount:Q,isLastQuestion:k,isFirstQuestion:S,handleStartQuiz:C,handleSelectAnswer:z,handleSubmitQuiz:w,handleReviewAnswers:K,handleRetryQuiz:H,handleBackToClass:U,goToQuestion:_,goToNextQuestion:I,goToPrevQuestion:P,getCurrentAnswer:q,formatTimeSpent:$}}function pe({classData:s,quiz:t,attempt:r,previousAttempts:a,progressStats:c}){const n=s.modules.find(w=>w.id===t.module_id)?.videos?.[0]?.id,{quizState:l,currentQuestionIndex:x,userAnswers:p,timeSpent:f,isSubmitting:j,quizResult:g,currentQuestion:N,totalQuestions:h,isLastQuestion:u,isFirstQuestion:v,handleStartQuiz:y,handleSelectAnswer:Q,handleSubmitQuiz:k,handleReviewAnswers:S,handleRetryQuiz:$,handleBackToClass:C,goToQuestion:z,goToNextQuestion:_,goToPrevQuestion:I,getCurrentAnswer:P}=xe({quiz:t,attempt:r,classId:s.id,videoId:n});return e.jsxs(J,{rightSidebar:e.jsx(ne,{quiz:t,currentQuestionIndex:x,userAnswers:p,quizState:l,timeSpent:f,onQuestionSelect:z,onSubmit:k,isSubmitting:j,progressStats:c}),children:[e.jsx(E,{title:`${t.title} - ${s.title}`}),e.jsx(me,{classTitle:s.title}),e.jsx(ue,{title:t.title,subtitle:t.module?.title}),e.jsxs("div",{className:"flex flex-col gap-6",children:[l==="intro"&&e.jsx(R,{quiz:t,previousAttempts:a,onStart:y,onBack:C}),(l==="in-progress"||l==="reviewing")&&e.jsx(G,{question:N,questionIndex:x,totalQuestions:h,selectedOptionId:P(N.id),onSelectOption:w=>Q(N.id,w),onNext:_,onPrev:I,onSubmit:k,isLastQuestion:u,isFirstQuestion:v,isSubmitting:j,isReviewing:l==="reviewing",quizResult:g,backToVideoUrl:n?route("user.study.watch",{classId:s.id,videoId:n}):void 0}),l==="submitted"&&g&&e.jsx(D,{result:g,quiz:t,timeSpent:f,onReview:S,onRetry:$,onBack:C})]})]})}function me({classTitle:s}){return e.jsxs("nav",{className:"mt-4 flex flex-wrap items-center gap-1 text-xs text-slate-500 sm:mt-2 sm:gap-2 sm:text-sm lg:mt-2",children:[e.jsx(B,{href:route("user.dashboard"),className:"transition-colors hover:text-primary",children:"Kelas Saya"}),e.jsx(d,{name:"chevron_right",size:16}),e.jsx(B,{href:route("user.my-class"),className:"transition-colors hover:text-primary",children:s}),e.jsx(d,{name:"chevron_right",size:16}),e.jsx("span",{className:"font-medium text-slate-900",children:"Quiz"})]})}function ue({title:s,subtitle:t}){return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-slate-900 md:text-3xl",children:s}),t&&e.jsx("p",{className:"text-base font-normal text-slate-500 md:text-lg",children:t})]})}export{pe as default};
