import{j as e,r as m,b as L,a as R,H as U,L as B}from"./app-CAUjhPa-.js";import{I as c}from"./Icon-JbZAKOja.js";import{U as E}from"./UserDashboardLayout-w0apLZjI.js";function J({quiz:s,currentQuestionIndex:t,userAnswers:a,quizState:r,timeSpent:d,onQuestionSelect:n,onSubmit:l,isSubmitting:o,progressStats:u}){const j=a.filter(x=>x.optionId!==null).length,h=s.questions.length,f=h-j,N=x=>{const p=Math.floor(x/60),g=x%60;return`${p.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}`},v=x=>x===t?"current":a[x]?.optionId!==null?"answered":"unanswered";return e.jsxs("aside",{className:"z-20 flex h-full w-full shrink-0 flex-col gap-4 overflow-y-auto bg-slate-50/50 p-4 pt-14 sm:gap-6 lg:w-[340px] lg:pt-4",children:[(r==="in-progress"||r==="reviewing")&&e.jsx(q,{timeSpent:d,formatTime:N,totalQuestions:h,answeredCount:j,remainingCount:f}),r!=="intro"&&e.jsx(W,{quiz:s,currentQuestionIndex:t,getQuestionStatus:v,onQuestionSelect:n}),r==="in-progress"&&l&&e.jsx(G,{onSubmit:l,isSubmitting:o,answeredCount:j,totalQuestions:h}),r==="intro"&&e.jsx(Y,{quiz:s,totalQuestions:h}),e.jsx(D,{progressStats:u})]})}function q({timeSpent:s,formatTime:t,totalQuestions:a,answeredCount:r,remainingCount:d}){return e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6 shadow-card",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-slate-500",children:"Waktu"}),e.jsx(c,{name:"timer",size:20,className:"text-slate-400"})]}),e.jsx("div",{className:"mb-6 rounded-md border border-slate-100 bg-slate-50 py-3 text-center font-mono text-4xl font-bold tracking-tight text-slate-900",children:t(s)}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 border-t border-slate-100 pt-4 text-center text-xs",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-medium text-slate-400",children:"Total"}),e.jsx("span",{className:"text-base font-bold text-slate-700",children:a})]}),e.jsxs("div",{className:"flex flex-col gap-1 border-x border-slate-100",children:[e.jsx("span",{className:"font-medium text-green-600",children:"Terjawab"}),e.jsx("span",{className:"text-base font-bold text-green-700",children:r})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-medium text-slate-400",children:"Sisa"}),e.jsx("span",{className:"text-base font-bold text-slate-700",children:d})]})]})]})}function W({quiz:s,currentQuestionIndex:t,getQuestionStatus:a,onQuestionSelect:r}){return e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6 shadow-card",children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider text-slate-500",children:"Navigasi Soal"})}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:s.questions.map((d,n)=>{const l=a(n);let o="aspect-square flex items-center justify-center rounded-md font-bold text-sm transition-colors";return l==="current"?o+=" bg-white text-primary border-2 border-primary shadow-sm":l==="answered"?o+=" bg-green-100 text-green-700 border border-transparent hover:border-green-300":o+=" bg-slate-50 text-slate-500 font-medium border border-slate-200 hover:bg-slate-100",e.jsx("button",{onClick:()=>r(n),className:o,children:n+1},n)})}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-x-4 gap-y-2 text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-3 w-3 rounded-full border border-green-200 bg-green-100"}),e.jsx("span",{children:"Terjawab"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-3 w-3 rounded-full border-2 border-primary bg-white"}),e.jsx("span",{children:"Saat ini"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-3 w-3 rounded-full border border-slate-200 bg-slate-50"}),e.jsx("span",{children:"Belum"})]})]})]})}function G({onSubmit:s,isSubmitting:t,answeredCount:a,totalQuestions:r}){const d=a===r;return e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4 shadow-card",children:[e.jsx("p",{className:"mb-3 text-center text-xs text-slate-400",children:d?"Semua jawaban sudah terisi.":`${a}/${r} soal terjawab. Pastikan semua terisi.`}),e.jsx("button",{onClick:s,disabled:t,className:"flex w-full items-center justify-center gap-2 rounded-md bg-primary px-4 py-3 text-sm font-bold text-white shadow-md transition-all hover:bg-green-700 hover:shadow-lg disabled:opacity-50",children:t?e.jsxs(e.Fragment,{children:[e.jsx(c,{name:"progress_activity",size:20,className:"animate-spin"}),"Mengirim..."]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{name:"check_circle",size:20}),"Submit Quiz"]})})]})}function Y({quiz:s,totalQuestions:t}){return e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6 shadow-card",children:[e.jsx("h4",{className:"mb-4 text-xs font-bold uppercase tracking-wider text-slate-400",children:"Informasi Quiz"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 rounded-xl bg-slate-50 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-md bg-blue-100",children:e.jsx(c,{name:"help",size:20,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-slate-900",children:t}),e.jsx("div",{className:"text-sm text-slate-500",children:"Pertanyaan"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-xl bg-slate-50 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-md bg-amber-100",children:e.jsx(c,{name:"star",size:20,className:"text-amber-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-slate-900",children:s.total_points||s.questions.reduce((a,r)=>a+r.points,0)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Poin"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-xl bg-slate-50 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-md bg-green-100",children:e.jsx(c,{name:"verified",size:20,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-slate-900",children:"70%"}),e.jsx("div",{className:"text-sm text-slate-500",children:"Nilai Minimum Lulus"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-xl bg-slate-50 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-md bg-purple-100",children:e.jsx(c,{name:"refresh",size:20,className:"text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-slate-900",children:"Unlimited"}),e.jsx("div",{className:"text-sm text-slate-500",children:"Percobaan"})]})]})]})]})}function D({progressStats:s}){return e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4 shadow-card",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-slate-500",children:"Progress Kelas"}),e.jsxs("span",{className:"font-bold text-primary",children:[s.progress_percent,"%"]})]}),e.jsx("div",{className:"h-2 w-full rounded-full bg-slate-200",children:e.jsx("div",{className:"h-2 rounded-full bg-primary transition-all duration-300",style:{width:`${s.progress_percent}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:[s.completed_videos," / ",s.total_videos," video selesai"]})]})}function V({quiz:s,previousAttempts:t,onStart:a,onBack:r}){const d=t.length>0?Math.max(...t.map(l=>l.score)):null,n=s.total_points||s.questions.reduce((l,o)=>l+o.points,0);return e.jsxs("div",{className:"shadow-card mx-auto w-full max-w-2xl rounded-2xl border border-slate-100 bg-white p-8",children:[e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsx("div",{className:"flex h-20 w-20 items-center justify-center rounded-2xl bg-primary/10",children:e.jsx(c,{name:"quiz",size:40,className:"text-primary"})})}),e.jsx("h2",{className:"mb-2 text-center text-2xl font-bold text-slate-900",children:s.title}),e.jsxs("p",{className:"mb-8 text-center text-slate-500",children:[s.is_pretest?"Pre-Test":"Quiz"," • ",s.module?.title]}),e.jsxs("div",{className:"mb-8 grid grid-cols-3 gap-4",children:[e.jsx(T,{value:s.questions.length,label:"Pertanyaan"}),e.jsx(T,{value:n,label:"Total Poin"}),e.jsx(T,{value:"70%",label:"Nilai Lulus"})]}),t.length>0&&e.jsx(X,{attempts:t,bestScore:d}),e.jsx(Z,{}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:r,className:"flex flex-1 items-center justify-center gap-2 rounded-xl border border-slate-200 px-6 py-3 font-semibold text-slate-600 transition-colors hover:bg-slate-50",children:[e.jsx(c,{name:"arrow_back",size:20}),"Kembali"]}),e.jsxs("button",{onClick:a,className:"flex flex-1 items-center justify-center gap-2 rounded-xl bg-primary px-6 py-3 font-semibold text-white transition-colors hover:bg-primary/90",children:["Mulai Quiz",e.jsx(c,{name:"play_arrow",size:20})]})]})]})}function T({value:s,label:t}){return e.jsxs("div",{className:"rounded-xl bg-slate-50 p-4 text-center",children:[e.jsx("div",{className:"mb-1 text-2xl font-bold text-slate-900",children:s}),e.jsx("div",{className:"text-sm text-slate-500",children:t})]})}function X({attempts:s,bestScore:t}){return e.jsxs("div",{className:"mb-8 rounded-xl border border-slate-100 bg-slate-50 p-4",children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold text-slate-700",children:"Riwayat Pengerjaan"}),e.jsx("div",{className:"space-y-2",children:s.slice(0,3).map((a,r)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-slate-500",children:["Percobaan ",s.length-r]}),e.jsxs("span",{className:`font-semibold ${a.is_passed?"text-green-600":"text-red-500"}`,children:[a.score,"%"," ",a.is_passed?"(Lulus)":"(Tidak Lulus)"]})]},a.id))}),t!==null&&e.jsx("div",{className:"mt-3 border-t border-slate-200 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-slate-700",children:"Nilai Terbaik"}),e.jsxs("span",{className:"font-bold text-primary",children:[t,"%"]})]})})]})}function Z(){return e.jsxs("div",{className:"mb-8 rounded-xl bg-amber-50 p-4",children:[e.jsxs("h3",{className:"mb-2 flex items-center gap-2 text-sm font-semibold text-amber-800",children:[e.jsx(c,{name:"info",size:18}),"Petunjuk Pengerjaan"]}),e.jsxs("ul",{className:"space-y-1 text-sm text-amber-700",children:[e.jsx("li",{children:"• Jawab semua pertanyaan dengan memilih satu opsi"}),e.jsx("li",{children:"• Anda dapat berpindah antar pertanyaan dengan bebas"}),e.jsx("li",{children:"• Pastikan semua pertanyaan terjawab sebelum mengumpulkan"}),e.jsx("li",{children:"• Nilai minimal untuk lulus adalah 70%"})]})]})}function ee({question:s,questionIndex:t,totalQuestions:a,selectedOptionId:r,onSelectOption:d,onNext:n,onPrev:l,onSubmit:o,isLastQuestion:u,isFirstQuestion:j,isSubmitting:h,isReviewing:f,quizResult:N}){const v=x=>{if(!f||!N)return null;const p=N.answers.find(g=>g.questionId===s.id);return p?x===p.correctOptionId?"correct":x===p.selectedOptionId&&!p.isCorrect?"incorrect":null:null};return e.jsxs("div",{className:"flex min-h-[600px] flex-col overflow-hidden rounded-xl border border-slate-200 bg-white shadow-card",children:[e.jsxs("div",{className:"px-6 pb-4 pt-8 bg-pri",children:[e.jsxs("div",{className:"mb-4 flex items-start justify-between",children:[e.jsxs("span",{className:"inline-block rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-slate-600",children:["Soal ",t+1," dari ",a]}),e.jsx("button",{className:"text-slate-400 transition-colors hover:text-yellow-500",title:"Laporkan soal",children:e.jsx(c,{name:"flag",size:20})})]}),e.jsx("h2",{className:"text-xl font-bold leading-tight text-slate-900 md:text-2xl",dangerouslySetInnerHTML:{__html:se(s.question)}})]}),e.jsx("div",{className:"flex-grow px-6 py-2",children:e.jsx("div",{className:"flex flex-col gap-4",children:s.options.map(x=>e.jsx(te,{option:x,isSelected:r===x.id,optionState:v(x.id),isReviewing:f,onSelect:()=>d(x.id)},x.id))})}),e.jsx(re,{onPrev:l,onNext:n,onSubmit:o,isFirstQuestion:j,isLastQuestion:u,isSubmitting:h,isReviewing:f})]})}function se(s){return s.replace(/`([^`]+)`/g,'<code class="rounded bg-slate-100 px-1.5 py-0.5 font-mono text-[0.9em] text-pink-600">$1</code>')}function te({option:s,isSelected:t,optionState:a,isReviewing:r,onSelect:d}){const n=()=>{const u="group relative flex cursor-pointer items-start gap-4 rounded-xl border-2 p-4 transition-all duration-200";return r?a==="correct"?`${u} border-green-500 bg-green-50`:a==="incorrect"?`${u} border-red-500 bg-red-50`:t?`${u} border-slate-300 bg-slate-50`:`${u} border-slate-200 bg-white`:t?`${u} border-primary bg-primary/5`:`${u} border-slate-200 bg-white hover:border-slate-300`},l=()=>r&&a==="correct"?"border-green-500 bg-green-500":r&&a==="incorrect"?"border-red-500 bg-red-500":t?"border-primary bg-white":"border-slate-300 bg-transparent",o=()=>r&&a==="correct"?"font-medium text-green-700":r&&a==="incorrect"?"font-medium text-red-700":t?"font-medium text-slate-900":"text-slate-700";return e.jsxs("label",{className:n(),onClick:r?void 0:d,children:[e.jsxs("div",{className:"relative mt-0.5 flex flex-shrink-0 items-center justify-center",children:[e.jsx("input",{type:"radio",name:"answer",checked:t,onChange:()=>{},className:"peer sr-only",disabled:r}),e.jsxs("div",{className:`flex h-5 w-5 items-center justify-center rounded-full border-2 ${l()}`,children:[t&&!r&&e.jsx("div",{className:"h-2.5 w-2.5 rounded-full bg-primary"}),r&&a==="correct"&&e.jsx(c,{name:"check",size:14,className:"text-white"}),r&&a==="incorrect"&&e.jsx(c,{name:"close",size:14,className:"text-white"})]})]}),e.jsx("div",{className:"flex-grow",children:e.jsx("span",{className:`block text-sm md:text-base ${o()} transition-colors group-hover:text-primary`,children:s.label})})]})}function re({onPrev:s,onNext:t,onSubmit:a,isFirstQuestion:r,isLastQuestion:d,isSubmitting:n,isReviewing:l}){return e.jsx("div",{className:"mt-auto border-t border-slate-100 bg-slate-50/50 px-6 py-6",children:e.jsx("div",{className:"flex flex-col-reverse items-center justify-between gap-4 sm:flex-row",children:e.jsxs("div",{className:"flex w-full items-center gap-3 sm:w-auto",children:[e.jsx("button",{onClick:s,disabled:r,className:"flex flex-1 items-center justify-center gap-2 rounded-md border border-slate-300 px-6 py-2.5 text-sm font-bold text-slate-700 transition-colors hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50 sm:flex-none",children:"Sebelumnya"}),d&&!l?e.jsx("button",{onClick:a,disabled:n,className:"flex flex-1 transform items-center justify-center gap-2 rounded-md bg-primary px-6 py-2.5 text-sm font-bold text-white shadow-md transition-all hover:bg-green-700 hover:shadow-lg active:scale-95 disabled:opacity-50 sm:flex-none",children:n?e.jsxs(e.Fragment,{children:[e.jsx(c,{name:"progress_activity",size:18,className:"animate-spin"}),"Mengirim..."]}):e.jsxs(e.Fragment,{children:["Kumpulkan",e.jsx(c,{name:"send",size:18})]})}):e.jsxs("button",{onClick:t,disabled:d&&l,className:"flex flex-1 transform items-center justify-center gap-2 rounded-md bg-primary px-6 py-2.5 text-sm font-bold text-white shadow-md transition-all hover:bg-green-700 hover:shadow-lg active:scale-95 disabled:opacity-50 sm:flex-none",children:["Selanjutnya",e.jsx(c,{name:"arrow_forward",size:18})]})]})})})}function ae({result:s,quiz:t,timeSpent:a,onReview:r,onRetry:d,onBack:n}){const l=s.totalQuestions-s.correctAnswers,o=s.correctAnswers/s.totalQuestions*100;return e.jsxs("div",{className:"shadow-card mx-auto w-full max-w-2xl rounded-2xl border border-slate-100 bg-white p-8",children:[e.jsx(le,{isPassed:s.isPassed}),e.jsx(ie,{score:s.score,isPassed:s.isPassed}),e.jsxs("div",{className:"mb-8 grid grid-cols-3 gap-4",children:[e.jsx(A,{icon:"check_circle",iconColor:"text-green-500",value:s.correctAnswers,label:"Benar"}),e.jsx(A,{icon:"cancel",iconColor:"text-red-500",value:l,label:"Salah"}),e.jsx(A,{icon:"schedule",iconColor:"text-blue-500",value:ne(a),label:"Waktu"})]}),e.jsx(de,{correct:s.correctAnswers,total:s.totalQuestions,percent:o,isPassed:s.isPassed}),e.jsx(oe,{isPassed:s.isPassed,onBack:n,onReview:r,onRetry:d})]})}function ne(s){const t=Math.floor(s/60),a=s%60;return`${t}:${a.toString().padStart(2,"0")}`}function le({isPassed:s}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsx("div",{className:`flex h-24 w-24 items-center justify-center rounded-full ${s?"bg-green-100":"bg-red-100"}`,children:e.jsx(c,{name:s?"emoji_events":"sentiment_dissatisfied",size:48,className:s?"text-green-600":"text-red-500"})})}),e.jsx("h2",{className:`mb-2 text-center text-2xl font-bold ${s?"text-green-600":"text-red-500"}`,children:s?"Selamat! Anda Lulus!":"Belum Berhasil"}),e.jsx("p",{className:"mb-8 text-center text-slate-500",children:s?"Anda telah menyelesaikan quiz dengan baik":"Jangan menyerah! Coba lagi untuk mendapatkan hasil yang lebih baik"})]})}function ie({score:s,isPassed:t}){return e.jsx("div",{className:"mb-8 flex justify-center",children:e.jsx("div",{className:`relative flex h-40 w-40 items-center justify-center rounded-full border-8 ${t?"border-green-500":"border-red-400"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-4xl font-bold ${t?"text-green-600":"text-red-500"}`,children:[s,"%"]}),e.jsx("div",{className:"text-sm text-slate-500",children:"Nilai Anda"})]})})})}function A({icon:s,iconColor:t,value:a,label:r}){return e.jsxs("div",{className:"rounded-xl bg-slate-50 p-4 text-center",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-center gap-1",children:[e.jsx(c,{name:s,size:20,className:t}),e.jsx("span",{className:"text-xl font-bold text-slate-900",children:a})]}),e.jsx("div",{className:"text-sm text-slate-500",children:r})]})}function de({correct:s,total:t,percent:a,isPassed:r}){return e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"mb-2 flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Progress"}),e.jsxs("span",{className:"font-medium text-slate-700",children:[s," / ",t," pertanyaan benar"]})]}),e.jsx("div",{className:"h-3 w-full overflow-hidden rounded-full bg-slate-100",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${r?"bg-green-500":"bg-red-400"}`,style:{width:`${a}%`}})})]})}function oe({isPassed:s,onBack:t,onReview:a,onRetry:r}){return e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:t,className:"flex flex-1 items-center justify-center gap-2 rounded-xl border border-slate-200 px-6 py-3 font-semibold text-slate-600 transition-colors hover:bg-slate-50",children:[e.jsx(c,{name:"arrow_back",size:20}),"Kembali"]}),e.jsxs("button",{onClick:a,className:"flex flex-1 items-center justify-center gap-2 rounded-xl border border-primary px-6 py-3 font-semibold text-primary transition-colors hover:bg-primary/5",children:[e.jsx(c,{name:"visibility",size:20}),"Lihat Jawaban"]}),!s&&e.jsxs("button",{onClick:r,className:"flex flex-1 items-center justify-center gap-2 rounded-xl bg-primary px-6 py-3 font-semibold text-white transition-colors hover:bg-primary/90",children:[e.jsx(c,{name:"refresh",size:20}),"Coba Lagi"]})]})}function ce({quiz:s,attempt:t,classId:a}){const[r,d]=m.useState(t?.submitted_at?"submitted":"intro"),[n,l]=m.useState(0),[o,u]=m.useState(()=>s.questions.map(i=>({questionId:i.id,optionId:null}))),[j,h]=m.useState(0),[f,N]=m.useState(!1),[v,x]=m.useState(null),p=s.questions[n],g=s.questions.length,y=o.filter(i=>i.optionId!==null).length,k=n===g-1,C=n===0;m.useEffect(()=>{let i;return r==="in-progress"&&(i=setInterval(()=>{h(b=>b+1)},1e3)),()=>clearInterval(i)},[r]);const w=m.useCallback(i=>{const b=Math.floor(i/60),_=i%60;return`${b.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`},[]),Q=m.useCallback(async()=>{try{await L.post(`/user/study/quiz/${s.id}/start`),d("in-progress")}catch(i){console.error("Failed to start quiz:",i),d("in-progress")}},[s.id]),S=m.useCallback((i,b)=>{u(_=>_.map(P=>P.questionId===i?{...P,optionId:b}:P))},[]),$=m.useCallback(i=>{l(i)},[]),z=m.useCallback(()=>{n<g-1&&l(i=>i+1)},[n,g]),I=m.useCallback(()=>{n>0&&l(i=>i-1)},[n]),F=m.useCallback(async()=>{const i=o.filter(b=>b.optionId===null);if(!(i.length>0&&!window.confirm(`Masih ada ${i.length} pertanyaan yang belum dijawab. Yakin ingin mengumpulkan?`))){N(!0);try{const b=await L.post(`/user/study/quiz/${s.id}/submit`,{answers:o});x(b.data.result),d("submitted")}catch(b){console.error("Failed to submit quiz:",b),alert("Gagal mengumpulkan quiz. Silakan coba lagi.")}finally{N(!1)}}},[s.id,o]),M=m.useCallback(()=>{d("reviewing"),l(0)},[]),O=m.useCallback(()=>{u(s.questions.map(i=>({questionId:i.id,optionId:null}))),h(0),l(0),x(null),d("intro")},[s.questions]),H=m.useCallback(()=>{R.visit(`/user/classes/${a}`)},[a]),K=m.useCallback(i=>o.find(b=>b.questionId===i)?.optionId??null,[o]);return{quizState:r,currentQuestionIndex:n,userAnswers:o,timeSpent:j,isSubmitting:f,quizResult:v,currentQuestion:p,totalQuestions:g,answeredCount:y,isLastQuestion:k,isFirstQuestion:C,handleStartQuiz:Q,handleSelectAnswer:S,handleSubmitQuiz:F,handleReviewAnswers:M,handleRetryQuiz:O,handleBackToClass:H,goToQuestion:$,goToNextQuestion:z,goToPrevQuestion:I,getCurrentAnswer:K,formatTimeSpent:w}}function fe({classData:s,quiz:t,attempt:a,previousAttempts:r,progressStats:d}){const{quizState:n,currentQuestionIndex:l,userAnswers:o,timeSpent:u,isSubmitting:j,quizResult:h,currentQuestion:f,totalQuestions:N,isLastQuestion:v,isFirstQuestion:x,handleStartQuiz:p,handleSelectAnswer:g,handleSubmitQuiz:y,handleReviewAnswers:k,handleRetryQuiz:C,handleBackToClass:w,goToQuestion:Q,goToNextQuestion:S,goToPrevQuestion:$,getCurrentAnswer:z}=ce({quiz:t,attempt:a,classId:s.id});return e.jsxs(E,{rightSidebar:e.jsx(J,{quiz:t,currentQuestionIndex:l,userAnswers:o,quizState:n,timeSpent:u,onQuestionSelect:Q,onSubmit:y,isSubmitting:j,progressStats:d}),children:[e.jsx(U,{title:`${t.title} - ${s.title}`}),e.jsx(xe,{classTitle:s.title}),e.jsx(me,{title:t.title,subtitle:t.module?.title}),e.jsxs("div",{className:"flex flex-col gap-6",children:[n==="intro"&&e.jsx(V,{quiz:t,previousAttempts:r,onStart:p,onBack:w}),(n==="in-progress"||n==="reviewing")&&e.jsx(ee,{question:f,questionIndex:l,totalQuestions:N,selectedOptionId:z(f.id),onSelectOption:I=>g(f.id,I),onNext:S,onPrev:$,onSubmit:y,isLastQuestion:v,isFirstQuestion:x,isSubmitting:j,isReviewing:n==="reviewing",quizResult:h}),n==="submitted"&&h&&e.jsx(ae,{result:h,quiz:t,timeSpent:u,onReview:k,onRetry:C,onBack:w})]})]})}function xe({classTitle:s}){return e.jsxs("nav",{className:"mt-4 flex flex-wrap items-center gap-1 text-xs text-slate-500 sm:mt-2 sm:gap-2 sm:text-sm lg:mt-2",children:[e.jsx(B,{href:route("user.dashboard"),className:"transition-colors hover:text-primary",children:"Kelas Saya"}),e.jsx(c,{name:"chevron_right",size:16}),e.jsx(B,{href:route("user.my-class"),className:"transition-colors hover:text-primary",children:s}),e.jsx(c,{name:"chevron_right",size:16}),e.jsx("span",{className:"font-medium text-slate-900",children:"Quiz"})]})}function me({title:s,subtitle:t}){return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-slate-900 md:text-3xl",children:s}),t&&e.jsx("p",{className:"text-base font-normal text-slate-500 md:text-lg",children:t})]})}export{fe as default};
